"use strict";var express=require("express"),jwt=require("jsonwebtoken"),mongoose=require("mongoose"),bcrypt=require("bcryptjs"),cookieParser=require("cookie-parser"),validate=require("./middle/validate.js"),cors=require("cors"),app=express();app.use(cors()),app.use(cookieParser()),app.use(express.json()),app.use(express.urlencoded({extended:!1}));var userSchema=new mongoose.Schema({username:{type:String,required:!0,min:6,max:255},email:{type:String,required:!0,min:6,unique:!0,max:255},password:{type:String,required:!0,min:6,max:255}},{timestamps:!0}),userModel=mongoose.model("user",userSchema),hashedPassword=function(r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(bcrypt.hash(r,12));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}})},registerRoute=function(r,t){var s,n,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.body,n=s.username,a=s.email,o=s.password,userModel.findOne({email:a})||t.json({message:"User already exist"}),e.t0=regeneratorRuntime,e.t1=userModel,e.t2=n,e.t3=a,e.next=9,regeneratorRuntime.awrap(hashedPassword(o));case 9:return e.t4=e.sent,e.t5={username:e.t2,email:e.t3,password:e.t4},e.t6=e.t1.create.call(e.t1,e.t5),e.next=14,e.t0.awrap.call(e.t0,e.t6);case 14:u=e.sent,t.send(u),t.end();case 17:case"end":return e.stop()}})},loginRoute=function(r,t){var s,n,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.body,n=s.email,a=s.password,n&&a){e.next=4;break}throw t.status(400),new Error("All fields are mandatory!");case 4:return e.next=6,regeneratorRuntime.awrap(userModel.findOne({email:n}));case 6:if(o=e.sent,e.t0=o,e.t0)return e.next=11,regeneratorRuntime.awrap(bcrypt.compare(a,o.password));e.next=12;break;case 11:e.t0=e.sent;case 12:if(!e.t0){e.next=18;break}u=jwt.sign({user:{username:o.username,email:o.email,id:o.id}},"Guruprasad",{expiresIn:"10000"}),t.cookie("token",u,{httpOnly:!0}),t.send({message:"success",redirect:"/dashboard"}),e.next=20;break;case 18:throw t.status(401),new Error("Credentials does not match");case 20:case"end":return e.stop()}})},homeRoute=function(e,r){r.send(e.user)};app.post("/register",registerRoute),app.post("/",loginRoute),app.get("/home",homeRoute),app.use("/dashboard",validate),mongoose.connect("mongodb://localhost:27017/Tokens").then(function(){console.log("Connected"),app.listen(8e3,function(){console.log("Server running on 8000")})});
//# sourceMappingURL=server.min.js.map
